# Spec Requirements Document

> Spec: Интеграция окон Android-приложений в WindowsLauncher
> Created: 2025-08-12
> Status: Planning

## Overview

Реализовать полную интеграцию Windows-окон Android-приложений в систему WindowsLauncher, включая обнаружение реальных окон WSA-приложений, интеграцию с AppSwitcher для переключения между приложениями, и корректное управление жизненным циклом Android-приложений при закрытии окон Windows.

## User Stories

### Переключение между Android-приложениями через AppSwitcher

As a пользователь WindowsLauncher, I want to переключаться между Android-приложениями через встроенный AppSwitcher (Alt+Tab), so that я могу работать с Android-приложениями так же удобно, как и с обычными Windows-приложениями.

**Detailed Workflow:**
1. Пользователь запускает несколько Android-приложений через WindowsLauncher
2. Каждое Android-приложение открывается в отдельном окне Windows (WSA window)
3. Пользователь нажимает Alt+Tab для вызова AppSwitcher
4. AppSwitcher отображает все запущенные приложения, включая Android-приложения с корректными иконками, названиями и статусами
5. Пользователь выбирает Android-приложение и нажимает Enter или отпускает Alt
6. Фокус переключается на выбранное Android-окно, приложение становится активным

### Управление окнами Android-приложений

As a пользователь WindowsLauncher, I want to управлять окнами Android-приложений так же, как обычными Windows-приложениями, so that я получаю единообразный опыт работы с приложениями независимо от их типа.

**Detailed Workflow:**
1. Android-приложения отображаются в AppSwitcher с корректной информацией о состоянии окна (активно, свернуто, не отвечает)
2. Пользователь может сворачивать/разворачивать Android-окна через Windows UI
3. При сворачивании Android-окна, AppSwitcher корректно отображает статус "свернуто"
4. При восстановлении окна через AppSwitcher, Android-приложение корректно активируется
5. Пользователь может переключаться между несколькими экземплярами одного Android-приложения

### Автоматическое завершение Android-процессов

As a пользователь WindowsLauncher, I want to чтобы Android-приложения корректно завершались при закрытии их Windows-окон, so that не происходило накопления "висячих" Android-процессов и утечек ресурсов.

**Detailed Workflow:**
1. Пользователь запускает Android-приложение через WindowsLauncher
2. Приложение открывается в WSA window с уникальным Windows handle
3. WindowsLauncher отслеживает состояние этого окна
4. Когда пользователь закрывает Windows-окно Android-приложения (X, Alt+F4, etc.)
5. WindowsLauncher автоматически вызывает остановку соответствующего Android-процесса
6. Android-приложение корректно завершается, ресурсы освобождаются
7. AppSwitcher удаляет приложение из списка активных

## Spec Scope

1. **Обнаружение реальных WSA-окон** - Реализовать алгоритм поиска Windows-окон, созданных WSA для Android-приложений, с корреляцией по package name и времени запуска
2. **Расширение событийной модели IApplicationLauncher** - Добавить события WindowActivated/WindowClosed для интеграции лаунчеров с AppSwitcher и жизненным циклом приложений
3. **Интеграция с AppSwitcher** - Заменить виртуальные WindowInfo на реальные данные Windows-окон для корректного отображения и переключения Android-приложений
4. **Синхронизация жизненного цикла** - Реализовать мониторинг закрытия Windows-окон и автоматическое завершение соответствующих Android-процессов
5. **Расширение WindowManager для WSA** - Добавить специализированные методы поиска и управления WSA-окнами с учетом их специфики

## Out of Scope

- Изменение UI AppSwitcher или добавление новых визуальных элементов
- Модификация Android Subsystem Service или WSA Integration Service  
- Поддержка multiple instances одного Android-приложения (оставляем текущую логику single instance)
- Интеграция с другими типами приложений (Desktop, Web, ChromeApp остаются без изменений)

## Expected Deliverable

1. **AppSwitcher корректно отображает Android-приложения** - Реальные окна, статусы, иконки вместо виртуальных заглушек
2. **Переключение между Android-приложениями работает** - Alt+Tab переводит фокус на выбранное Android-окно
3. **Автоматическое завершение Android-процессов** - Закрытие Windows-окна завершает соответствующий Android-процесс без "висячих" процессов