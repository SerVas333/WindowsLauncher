# Spec Tasks

## Tasks

- [ ] 1. Расширение интерфейсов для событийной модели
  - [ ] 1.1 Добавить события WindowActivated и WindowClosed в IApplicationLauncher
  - [ ] 1.2 Добавить методы FindWSAWindowAsync, GetWSAWindowsAsync, IsWSAWindowAsync в IWindowManager
  - [ ] 1.3 Проверить компиляцию и отсутствие breaking changes
  - [ ] 1.4 Написать тесты для новых интерфейсов и проверить их

- [ ] 2. Реализация обнаружения WSA-окон в WindowManager
  - [ ] 2.1 Реализовать FindWSAWindowAsync с корреляционным алгоритмом
  - [ ] 2.2 Реализовать GetWSAWindowsAsync для получения всех WSA-окон
  - [ ] 2.3 Реализовать IsWSAWindowAsync для проверки типа окна
  - [ ] 2.4 Добавить кэширование найденных WSA-окон на 60 секунд
  - [ ] 2.5 Протестировать с реальными WSA-приложениями
  - [ ] 2.6 Написать unit и интеграционные тесты

- [ ] 3. Улучшение WSAApplicationLauncher для работы с реальными окнами
  - [ ] 3.1 Модифицировать CreateApplicationInstance для поиска реальных WSA-окон
  - [ ] 3.2 Реализовать мониторинг состояния окон через Timer
  - [ ] 3.3 Улучшить SwitchToAsync для работы с реальными Windows handles
  - [ ] 3.4 Добавить генерацию событий WindowActivated и WindowClosed
  - [ ] 3.5 Обеспечить graceful fallback на виртуальные окна при ошибках
  - [ ] 3.6 Протестировать с AppSwitcher вручную
  - [ ] 3.7 Написать comprehensive тесты для WSAApplicationLauncher

- [ ] 4. Интеграция с ApplicationLifecycleService
  - [ ] 4.1 Модифицировать SubscribeToLauncherEvents для подписки на новые события
  - [ ] 4.2 Реализовать OnLauncherWindowActivated и OnLauncherWindowClosed
  - [ ] 4.3 Обеспечить совместимость со всеми типами лаунчеров
  - [ ] 4.4 Протестировать интеграцию с реальными приложениями
  - [ ] 4.5 Написать тесты для автоматической подписки на события

- [ ] 5. Тестирование полной интеграции
  - [ ] 5.1 Интеграционные тесты для запуска Android-приложений с реальными окнами
  - [ ] 5.2 Тесты переключения между Android-приложениями через AppSwitcher
  - [ ] 5.3 Тесты автоматического завершения Android-процессов при закрытии окон
  - [ ] 5.4 Регрессионные тесты для всех типов лаунчеров (Desktop, Web, ChromeApp, TextEditor)
  - [ ] 5.5 Тесты производительности и стабильности
  - [ ] 5.6 Проверить что все тесты проходят

- [ ] 6. Документация и финализация
  - [ ] 6.1 Обновить XML-комментарии для новых методов и событий
  - [ ] 6.2 Добавить примеры использования в техническую документацию
  - [ ] 6.3 Обновить ANDROID_SETUP.md с описанием новой функциональности
  - [ ] 6.4 Финальная проверка совместимости со всеми компонентами системы