<!-- SmtpEditWindow.xaml -->
<Window x:Class="WindowsLauncher.UI.Views.SmtpEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:loc="clr-namespace:WindowsLauncher.UI.Infrastructure.Localization"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="600" Width="550"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource SurfaceBrush}"
        MinHeight="500" MinWidth="500"
        ResizeMode="NoResize">

    <!-- Все необходимые ресурсы подключены глобально через App.xaml -->

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Content -->
            <RowDefinition Height="Auto"/>
            <!-- Actions -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="24,16">
            <StackPanel>
                <TextBlock Text="{Binding HeaderTitle}" 
                           FontSize="20" FontWeight="Light" 
                           Foreground="White" FontFamily="Segoe UI"/>
                <TextBlock Text="{Binding HeaderSubtitle}" 
                           FontSize="12" Foreground="{StaticResource OnPrimaryBrush}" Opacity="0.9"/>
            </StackPanel>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" Padding="24" Background="White">
            <StackPanel>
                <!-- Basic Settings -->
                <GroupBox Header="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_BasicSettings}" 
                         Style="{StaticResource GroupBoxStyle}" Margin="0,0,0,20">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Server Name -->
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Name}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2"
                                Style="{StaticResource TextBoxStyle}"
                                Text="{Binding ServerName, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,0,12"/>

                        <!-- Server Type -->
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Type}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2"
                                 Style="{StaticResource ComboBoxStyle}"
                                 ItemsSource="{Binding AvailableServerTypes}"
                                 SelectedItem="{Binding SelectedServerType}"
                                 DisplayMemberPath="DisplayName"
                                 SelectedValuePath="Value"
                                 Margin="0,0,0,12"/>

                        <!-- Host -->
                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Host}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="2" Grid.Column="1"
                                Style="{StaticResource TextBoxStyle}"
                                Text="{Binding Host, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,8,12"/>
                        <TextBlock Grid.Row="2" Grid.Column="2" 
                                  Text="smtp.company.com"
                                  FontSize="10" Foreground="{StaticResource MutedTextBrush}" 
                                  VerticalAlignment="Center"/>

                        <!-- Port -->
                        <TextBlock Grid.Row="3" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Port}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="3" Grid.Column="1"
                                Style="{StaticResource TextBoxStyle}"
                                Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,8,0"/>
                        <TextBlock Grid.Row="3" Grid.Column="2" 
                                  Text="587, 465, 25"
                                  FontSize="10" Foreground="{StaticResource MutedTextBrush}" 
                                  VerticalAlignment="Center"/>
                    </Grid>
                </GroupBox>

                <!-- Authentication Settings -->
                <GroupBox Header="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Authentication}" 
                         Style="{StaticResource GroupBoxStyle}" Margin="0,0,0,20">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Username -->
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Username}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="0" Grid.Column="1"
                                Style="{StaticResource TextBoxStyle}"
                                Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,0,12"/>

                        <!-- Password -->
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Password}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <Grid Grid.Row="1" Grid.Column="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- PasswordBox for hidden password -->
                            <PasswordBox Grid.Column="0" x:Name="PasswordBox"
                                        Style="{StaticResource PasswordBoxStyle}"
                                        PasswordChanged="PasswordBox_PasswordChanged"
                                        Visibility="{Binding IsPasswordVisible, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                            
                            <!-- TextBox for visible password -->
                            <TextBox Grid.Column="0" x:Name="PasswordTextBox"
                                    Style="{StaticResource TextBoxStyle}"
                                    Text="{Binding Password, UpdateSourceTrigger=PropertyChanged}"
                                    Visibility="{Binding IsPasswordVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            
                            <Button Grid.Column="1" Style="{StaticResource SecondaryButtonStyle}"
                                   Command="{Binding TogglePasswordVisibilityCommand}"
                                   Width="30" Height="30" Margin="4,0,0,0"
                                   ToolTip="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_TogglePasswordVisibility}">
                                <fa:ImageAwesome Icon="{Binding PasswordVisibilityIcon}" 
                                               Width="12" Height="12" 
                                               Foreground="{StaticResource PrimaryBrush}"/>
                            </Button>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- Security Settings -->
                <GroupBox Header="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_Security}" 
                         Style="{StaticResource GroupBoxStyle}" Margin="0,0,0,20">
                    <StackPanel Margin="16">
                        <!-- SSL -->
                        <CheckBox IsChecked="{Binding UseSSL}"
                                 Style="{StaticResource CheckBoxStyle}"
                                 Content="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_UseSSL}"
                                 Margin="0,0,0,12"/>

                        <!-- StartTLS -->
                        <CheckBox IsChecked="{Binding UseStartTLS}"
                                 Style="{StaticResource CheckBoxStyle}"
                                 Content="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_UseStartTLS}"
                                 Margin="0,0,0,12"/>

                        <!-- Security Info -->
                        <Border Background="{StaticResource InfoBackgroundBrush}"
                               BorderBrush="{StaticResource InfoBorderBrush}"
                               BorderThickness="1" CornerRadius="4" Padding="12">
                            <StackPanel>
                                <TextBlock Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_SecurityInfo}" 
                                          FontSize="12" FontWeight="SemiBold" 
                                          Foreground="{StaticResource InfoTextBrush}"
                                          Margin="0,0,0,4"/>
                                <TextBlock Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_SecurityDetails}" 
                                          FontSize="11" 
                                          Foreground="{StaticResource InfoTextBrush}"
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </GroupBox>

                <!-- Default From Settings -->
                <GroupBox Header="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_DefaultFrom}" 
                         Style="{StaticResource GroupBoxStyle}" Margin="0,0,0,20">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Default From Email -->
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_FromEmail}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="0" Grid.Column="1"
                                Style="{StaticResource TextBoxStyle}"
                                Text="{Binding DefaultFromEmail, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,0,12"/>

                        <!-- Default From Name -->
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_FromName}" 
                                  FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="1" Grid.Column="1"
                                Style="{StaticResource TextBoxStyle}"
                                Text="{Binding DefaultFromName, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,0,12"/>

                        <!-- Info -->
                        <TextBlock Grid.Row="2" Grid.Column="1" 
                                  Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_FromInfo}" 
                                  FontSize="11" Foreground="{StaticResource MutedTextBrush}" 
                                  TextWrapping="Wrap"/>
                    </Grid>
                </GroupBox>

                <!-- Test Connection -->
                <GroupBox Header="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=SmtpEdit_TestConnection}" 
                         Style="{StaticResource GroupBoxStyle}">
                    <StackPanel Margin="16">
                        <!-- Test Button and Status -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0" Style="{StaticResource SecondaryButtonStyle}"
                                   Command="{Binding TestConnectionCommand}"
                                   IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBooleanConverter}}"
                                   Width="120" Height="32" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <fa:ImageAwesome Icon="{Binding TestButtonIcon}" Width="12" Height="12" 
                                                   Foreground="{StaticResource PrimaryBrush}" 
                                                   VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding TestButtonText}"
                                             Foreground="{StaticResource PrimaryBrush}" 
                                             VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <TextBlock Grid.Column="1" Text="{Binding TestStatusMessage}" 
                                      FontSize="12" 
                                      Foreground="{StaticResource MutedTextBrush}"
                                      VerticalAlignment="Center"
                                      TextWrapping="Wrap"/>
                        </Grid>

                        <!-- Test Result -->
                        <Border Background="{Binding TestResultBackground}"
                               BorderBrush="{Binding TestResultBorderBrush}"
                               BorderThickness="1" CornerRadius="4" Padding="12"
                               Visibility="{Binding TestResult, Converter={StaticResource StringToVisibilityConverter}}">
                            <TextBlock Text="{Binding TestResult}" 
                                      FontSize="12" 
                                      Foreground="{Binding TestResultForeground}"
                                      TextWrapping="Wrap"/>
                        </Border>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <!-- Actions -->
        <Border Grid.Row="2" Background="White" BorderThickness="0,1,0,0" 
                BorderBrush="{StaticResource LightGrayBrush}" Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Validation Message -->
                <TextBlock Grid.Column="0" Text="{Binding ValidationMessage}" 
                          Foreground="{StaticResource ErrorBrush}" 
                          VerticalAlignment="Center"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource PrimaryButtonStyle}"
                          Command="{Binding SaveCommand}"
                          IsEnabled="{Binding CanSave}"
                          Width="100" Height="36" Margin="0,0,8,0">
                        <TextBlock Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=Common_Save}"
                                 Foreground="White" 
                                 VerticalAlignment="Center"/>
                    </Button>

                    <Button Style="{StaticResource SecondaryButtonStyle}"
                          Command="{Binding CancelCommand}"
                          Width="100" Height="36">
                        <TextBlock Text="{Binding Source={x:Static loc:LocalizationHelper.Instance}, Path=CurrentCulture, Converter={StaticResource LocalizedStringConverter}, ConverterParameter=Common_Cancel}"
                                 Foreground="{StaticResource PrimaryBrush}" 
                                 VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>