<Window x:Class="WindowsLauncher.UI.Views.DatabaseSettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Настройки базы данных - KDV Corporate Portal"
        Width="670" Height="700"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="{StaticResource SurfaceBrush}">

    <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Margin="20">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок -->
            <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" 
                    CornerRadius="8,8,0,0" Padding="20">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="🗄️" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="Настройки базы данных" 
                               FontSize="20" FontWeight="Bold" 
                               Foreground="{StaticResource OnPrimaryBrush}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Выберите тип и настройки подключения к базе данных" 
                               FontSize="12" 
                               Foreground="{StaticResource OnPrimaryBrush}"
                               HorizontalAlignment="Center"
                               Opacity="0.9"
                               Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Основной контент -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
                <StackPanel>
                    <!-- Выбор типа БД -->
                    <GroupBox Header="Тип базы данных" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <RadioButton x:Name="SQLiteRadio" 
                                         Content="SQLite (рекомендуется)" 
                                         GroupName="DatabaseType"
                                         IsChecked="True"
                                         Style="{StaticResource RadioButtonStyle}"
                                         Margin="0,0,0,10"
                                         Checked="DatabaseType_Changed"/>
                            <TextBlock Text="• Легкая локальная база данных" 
                                       FontSize="11" 
                                       Foreground="{StaticResource OnPrimaryBrush}"
                                       Margin="20,0,0,5"/>
                            <TextBlock Text="• Не требует установки сервера" 
                                       FontSize="11" 
                                       Foreground="{StaticResource OnPrimaryBrush}"
                                       Margin="20,0,0,15"/>

                            <RadioButton x:Name="FirebirdRadio" 
                                         Content="Firebird (для корпоративного использования)" 
                                         GroupName="DatabaseType"
                                         Style="{StaticResource RadioButtonStyle}"
                                         Margin="0,0,0,10"
                                         Checked="DatabaseType_Changed"/>
                            <TextBlock Text="• Профессиональная СУБД" 
                                       FontSize="11" 
                                       Foreground="{StaticResource OnPrimaryBrush}"
                                       Margin="20,0,0,5"/>
                            <TextBlock Text="• Поддержка клиент-серверной архитектуры" 
                                       FontSize="11" 
                                       Foreground="{StaticResource OnPrimaryBrush}"
                                       Margin="20,0,0,0"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- SQLite настройки -->
                    <GroupBox x:Name="SQLiteSettings" Header="Настройки SQLite" Margin="0,0,0,20">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                       Text="Файл базы данных:" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <TextBox x:Name="SQLitePathTextBox" 
                                     Grid.Row="0" Grid.Column="1" 
                                     Style="{StaticResource TextBoxStyle}"
                                     Text="launcher.db"
                                     Margin="0,0,10,0"/>
                            <Button x:Name="BrowseSQLiteButton" 
                                    Grid.Row="0" Grid.Column="2" 
                                    Content="📁"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Width="40"
                                    ToolTip="Выбрать файл"
                                    Click="BrowseSQLite_Click"
                                    Margin="0,0,5,0"/>
                            <Button x:Name="DefaultSQLiteButton" 
                                    Grid.Row="0" Grid.Column="3" 
                                    Content="⚙️"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Width="40"
                                    ToolTip="Значения по умолчанию"
                                    Click="DefaultSQLite_Click"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" 
                                       Text="💡 База данных будет создана автоматически при первом запуске" 
                                       FontSize="11" 
                                       Foreground="{StaticResource SecondaryTextBrush}"
                                       Margin="0,10,0,0"/>
                        </Grid>
                    </GroupBox>

                    <!-- Firebird настройки -->
                    <GroupBox x:Name="FirebirdSettings" Header="Настройки Firebird" Margin="0,0,0,20" Visibility="Collapsed">
                        <StackPanel Margin="10">
                            <!-- Режим подключения -->
                            <TextBlock Text="Режим подключения:" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <RadioButton x:Name="EmbeddedRadio" 
                                             Content="Embedded (локальная БД)" 
                                             GroupName="FirebirdMode"
                                             IsChecked="True"
                                             Style="{StaticResource RadioButtonStyle}"
                                             Margin="0,0,20,0"
                                             Checked="FirebirdMode_Changed"/>
                                <RadioButton x:Name="ClientServerRadio" 
                                             Content="Client-Server (сетевая БД)" 
                                             GroupName="FirebirdMode"
                                             Style="{StaticResource RadioButtonStyle}"
                                             Checked="FirebirdMode_Changed"/>
                            </StackPanel>

                            <!-- Embedded настройки -->
                            <StackPanel x:Name="EmbeddedPanel">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Text="Файл базы данных:" 
                                               VerticalAlignment="Center" 
                                               Margin="0,0,10,0"/>
                                    <TextBox x:Name="FirebirdPathTextBox" 
                                             Grid.Row="0" Grid.Column="1" 
                                             Style="{StaticResource TextBoxStyle}"
                                             Text="launcher.fdb"
                                             Margin="0,0,10,0"/>
                                    <Button x:Name="BrowseFirebirdButton" 
                                            Grid.Row="0" Grid.Column="2" 
                                            Content="📁"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Width="40"
                                            ToolTip="Выбрать файл"
                                            Click="BrowseFirebird_Click"
                                            Margin="0,0,5,0"/>
                                    <Button x:Name="DefaultFirebirdButton" 
                                            Grid.Row="0" Grid.Column="3" 
                                            Content="⚙️"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Width="40"
                                            ToolTip="Значения по умолчанию"
                                            Click="DefaultFirebird_Click"/>
                                </Grid>
                            </StackPanel>

                            <!-- Client-Server настройки -->
                            <StackPanel x:Name="ClientServerPanel" Visibility="Collapsed">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Text="Сервер:" 
                                               VerticalAlignment="Center"/>
                                    <TextBox x:Name="ServerTextBox" 
                                             Grid.Row="0" Grid.Column="1" 
                                             Style="{StaticResource TextBoxStyle}"
                                             Text="localhost"
                                             Margin="0,0,10,0"/>
                                    <TextBlock Grid.Row="0" Grid.Column="2" 
                                               Text="Порт:" 
                                               VerticalAlignment="Center"
                                               Margin="0,0,5,0"/>
                                    <TextBox x:Name="PortTextBox" 
                                             Grid.Row="0" Grid.Column="3" 
                                             Style="{StaticResource TextBoxStyle}"
                                             Text="3050"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" 
                                               Text="Имя БД:" 
                                               VerticalAlignment="Center"
                                               Margin="0,10,0,0"/>
                                    <TextBox x:Name="DatabaseNameTextBox" 
                                             Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3"
                                             Style="{StaticResource TextBoxStyle}"
                                             Text="LAUNCHER"
                                             ToolTip="Имя базы данных на сервере (без расширения)"
                                             Margin="0,10,0,0"/>
                                </Grid>
                            </StackPanel>

                            <!-- Учетные данные -->
                            <TextBlock Text="Учетные данные:" FontWeight="SemiBold" Margin="0,20,0,10"/>
                            <TextBlock Text="💡 Для безопасности используйте надежные пароли. Примеры скриптов развертывания с безопасными паролями находятся в папке Scripts/" 
                                       FontSize="10" 
                                       Foreground="{StaticResource SecondaryTextBrush}"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,10"/>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" 
                                           Text="Пользователь:" 
                                           VerticalAlignment="Center"/>
                                <TextBox x:Name="UsernameTextBox" 
                                         Grid.Row="0" Grid.Column="1" 
                                         Style="{StaticResource TextBoxStyle}"
                                         Text="SYSDBA"
                                         Margin="0,0,0,10"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" 
                                           Text="Пароль:" 
                                           VerticalAlignment="Center"/>
                                <PasswordBox x:Name="PasswordBox" 
                                             Grid.Row="1" Grid.Column="1" 
                                             Style="{StaticResource PasswordBoxStyle}"
                                             ToolTip="Рекомендуется использовать надежный пароль (например: KDV_Launcher_2025!)"/>
                            </Grid>

                            <!-- Дополнительные параметры -->
                            <Expander Header="Дополнительные параметры" Margin="0,20,0,0">
                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Text="Кодировка:" 
                                               VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CharsetComboBox" 
                                              Grid.Row="0" Grid.Column="1" 
                                              Style="{StaticResource ComboBoxStyle}"
                                              Margin="0,0,0,10">
                                        <ComboBoxItem Content="UTF8" IsSelected="True"/>
                                        <ComboBoxItem Content="WIN1251"/>
                                        <ComboBoxItem Content="ISO8859_1"/>
                                    </ComboBox>

                                    <TextBlock Grid.Row="1" Grid.Column="0" 
                                               Text="Диалект:" 
                                               VerticalAlignment="Center"/>
                                    <ComboBox x:Name="DialectComboBox" 
                                              Grid.Row="1" Grid.Column="1" 
                                              Style="{StaticResource ComboBoxStyle}"
                                              Margin="0,0,0,10">
                                        <ComboBoxItem Content="3" IsSelected="True"/>
                                        <ComboBoxItem Content="1"/>
                                    </ComboBox>

                                    <TextBlock Grid.Row="2" Grid.Column="0" 
                                               Text="Таймаут (сек):" 
                                               VerticalAlignment="Center"/>
                                    <TextBox x:Name="TimeoutTextBox" 
                                             Grid.Row="2" Grid.Column="1" 
                                             Style="{StaticResource TextBoxStyle}"
                                             Text="30"/>
                                </Grid>
                            </Expander>
                        </StackPanel>
                    </GroupBox>

                    <!-- Информация о версии БД -->
                    <GroupBox Header="Информация о версиях" Margin="0,0,0,20">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="140"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                       Text="Версия приложения:" 
                                       VerticalAlignment="Center"/>
                            <TextBlock x:Name="AppVersionText" 
                                       Grid.Row="0" Grid.Column="1" 
                                       Text="Загрузка..."
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                       Text="Версия БД:" 
                                       VerticalAlignment="Center"
                                       Margin="0,5,0,0"/>
                            <TextBlock x:Name="DbVersionText" 
                                       Grid.Row="1" Grid.Column="1" 
                                       Text="Не инициализирована"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"
                                       Margin="0,5,0,0"/>

                            <Button x:Name="InitializeDatabaseButton" 
                                    Grid.Row="1" Grid.Column="2"
                                    Content="🔧 Инициализировать БД"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Click="InitializeDatabase_Click"
                                    Margin="10,5,0,0"
                                    Visibility="Collapsed"/>

                            <TextBlock x:Name="CompatibilityText" 
                                       Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3"
                                       Text="Совместимость: проверка..."
                                       FontSize="11"
                                       Margin="0,10,0,0"/>
                        </Grid>
                    </GroupBox>

                    <!-- Статус подключения -->
                    <Border x:Name="StatusPanel" 
                            Background="{StaticResource SurfaceVariantBrush}" 
                            CornerRadius="8" 
                            Padding="15" 
                            Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse x:Name="StatusIndicator" 
                                     Width="12" Height="12" 
                                     Fill="{StaticResource SecondaryTextBrush}"
                                     Margin="0,0,10,0"
                                     VerticalAlignment="Center"/>
                            <TextBlock x:Name="StatusText" 
                                       Text="Настройки не применены" 
                                       VerticalAlignment="Center"
                                       Foreground="{StaticResource PrimaryTextBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Кнопки действий -->
            <Border Grid.Row="2" BorderBrush="{StaticResource BorderBrush}" 
                    BorderThickness="0,1,0,0" Padding="20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Тест подключения -->
                    <Button x:Name="TestConnectionButton" 
                            Grid.Column="0"
                            Content="🔍 Тест подключения"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Margin="0,0,15,0"
                            Click="TestConnection_Click"/>

                    <!-- Основные кнопки -->
                    <Button x:Name="CancelButton" 
                            Grid.Column="2"
                            Content="Отмена"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="100"
                            Margin="0,0,10,0"
                            Click="Cancel_Click"/>

                    <Button x:Name="ResetButton" 
                            Grid.Column="3"
                            Content="Сброс"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="100"
                            Margin="0,0,10,0"
                            Click="Reset_Click"/>

                    <Button x:Name="SaveButton" 
                            Grid.Column="4"
                            Content="Сохранить"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Width="120"
                            FontWeight="SemiBold"
                            Click="Save_Click"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>